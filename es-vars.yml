# To test this file, run ./es-test-vars.sh

# DANGER! Anything added here crushes per-host/group vars from es-inventory.yml!!

# NOTE! variables expanded lazily (when variable referenced/expanded)
# so values can come from:
# * es-inventory.yml (per-group, or per-node)
# * here, or another vars file (overrides inventory)
# * "set_fact" in playbook
# [IMO it's the ONLY thing about ansible that's better than shell scripts! -phil]

# PLEASE KEEP SORTED!

# timeout in ansible-elasticsearch/tasks/main.yml:
es_api_sleep: 5

# MC addition to disable cert generation:
es_certificates: false

#### vars for ansible-elasticsearch (all start with es_)
# key/values copied to elasticsearch.yml output file:
# IF YOU MAKE CHANGES, TEST WITH ./es-test-vars.sh!!!
es_config:
  # PLEASE ADD ITEMS IN SORTED ORDER BELOW THIS LINE!
  bootstrap.memory_lock: true

  cluster.initial_master_nodes: "{{ mc_es_initialize | ternary(mc_es_seed_hosts,[]) }}"

  cluster.name: "{{ mc_es_cluster_name | default('elasticsearch') }}"

  # seed hosts is list of master-elibile nodes; port is defaulted from transport.port
  # (NOTE! if you add ports to mc_es_seed_hosts you'll break the mc_es_master test below)
  discovery.seed_hosts: "{{ mc_es_seed_hosts }}"

  http.host: 0.0.0.0 # allow connections from off-host

  # to override, set in es-inventory group vars section:
  http.port: "{{ mc_es_http_port }}"

  # default to address of interface with default route
  # rather than rely on all servers having the same interface names
  # (can set mc_es_network_host per-host in inventory)
  network.host: "{{ mc_es_network_host | default(ansible_default_ipv4.address) }}"

  # node.name defaults to inventory_hostname

  node.roles: "{{ mc_es_node_roles }}"

  reindex.remote.whitelist: "{{ mc_es_reindex_whitelist | default('') }}"

  # to override, set in es-inventory group vars section:
  transport.port: "{{ mc_es_transport_port }}"

  xpack.security.enabled: false
  xpack.security.enrollment.enabled: false
  xpack.security.http.ssl:
    enabled: false
  xpack.security.transport.ssl:
    enabled: false

  # PLEASE ADD ITEMS ABOVE IN SORTED ORDER!

es_data_dirs: ["/data/elasticsearch/data"]
es_heap_size: 32256m    # 31.5g
# ES7/8 come with bundled /usr/share/elasticsearch/jdk/bin/java
#es_java: openjdk-21-jre-headless
#es_java_install: true
es_log_dir: "/data/elasticsearch/logs"
es_start_service: true
es_templates: false
es_templates_fileglob: ""
es_version: 8.17.3
es_version_lock: true

# quiet ssh complaints (ansible setting, not ES specific)
host_key_checking: false

################ MC specific vars (start with mc_)

# elastic search specific vars (just about everything) should start with mc_es_

# checkout of mc_es_ansible_elasticsearch_repo
mc_es_ansible_elasticsearch: "{{ mc_tmp }}/ansible-elasticsearch"
# force checkout, and remove
mc_es_ansible_elasticsearch_force_checkout_cleanup: true
mc_es_ansible_elasticsearch_repo: "https://github.com/mediacloud/ansible-elasticsearch.git"

mc_es_http_port: 9200

# **WHEN INITIALIZING A NEW CLUSTER FROM SCRATCH**
# set to true, deploy, then set to false and run again!
mc_es_initialize: false # do not check-in set to true!!!

# ansible_hostname does not work here for es-test-vars?
mc_es_master: "{{ inventory_hostname in mc_es_seed_hosts }}"

mc_es_node_roles: "{{ mc_es_master | ternary(mc_es_node_roles_master,mc_es_node_roles_data) }}"
mc_es_node_roles_data: ["data"]
mc_es_node_roles_master: ["master", "data"]

# TEMPORARY while reindexing from old cluster:
mc_es_reindex_whitelist: ramos.angwin:9200,bradley.angwin:9200,woodward.angwin:9200

mc_es_transport_port: 9300

# used in molecule destroy playbook
mc_tmp: "tmp"

# PLEASE KEEP THIS FILE IN SORTED ORDER!
# (KEEP THIS LINE LAST!)
